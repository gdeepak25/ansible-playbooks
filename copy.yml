---
  - name: Copy .NET config variables from one file to another on Windows
    hosts: windows
    gather_facts: false
    tasks:
      - name: Read specific variable from source config file
        win_shell: Select-String -Path "D:\\trident\\trident04config.config" -Pattern '<add key="DiscoveryClientFTP"'
        register: discovery_client_ftp_line
  
      - name: Check if variable was found in source config
        fail:
          msg: "The key 'DiscoveryClientFTP' was not found in the source config file."
        when: discovery_client_ftp_line.stdout == ""
  
      - name: Copy variable to destination config file
        win_lineinfile:
          path: "D:\\artifact\\artifactconfig.config"
          regexp: '<add key="DiscoveryClientFTP".*'
          line: "{{ discovery_client_ftp_line.stdout }}"
          state: present
  
      - name: Verify changes in destination file
        win_shell: Get-Content -Path "D:\\artifact\\artifactconfig.config"
        register: destination_config_content
  
      - debug:
          var: destination_config_content.stdout_lines
  