---
  - name: Copy specific XML configuration key from source to destination on Windows
    hosts: windows
    vars:
      source_config_file: "D:\\trident\\source.config"   # Full path to source file
      target_config_file: "D:\\artifact\\target.config"  # Full path to target file
      key_to_copy: "DiscoveryClientFTP"
    tasks:
    - name: Read the source configuration file with PowerShell
      win_shell: |
      Get-Content -Path "{{ source_config_file }}" | Out-String
      register: source_content
  
    - name: Extract the value of the key from the source content
      set_fact:
        extracted_value: "{{ source_content.stdout | regex_search('<add key=\"' + key_to_copy + '\" value=\"([^\"]+)\"', '\\1') }}"
  
    - name: Ensure target file exists
      win_copy:
        content: ""
        dest: "{{ target_config_file }}"
        force: no
  
    - name: Insert or update the key-value pair in the target config file
      win_lineinfile:
        path: "{{ target_config_file }}"
        regexp: '<add key="{{ key_to_copy }}" value=".*" />'
        line: '<add key="{{ key_to_copy }}" value="{{ extracted_value }}" />'
        create: yes
  